#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –Ω–∞ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö
"""

import sys
import os
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
sys.path.insert(0, str(Path(__file__).parent))

from analyze_comments_hf import (
    normalize_text,
    detect_toxicity_patterns,
    detect_language,
)

# –¢–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã - –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å –Ω–∏–∑–∫–∏–º —Å–∫–æ—Ä–æ–º
test_cases = [
    {
        "text": "—Ç–∞–∫–∏—Ö –æ—Ç–æ—Ä–≤–∏ –≥–æ–ª–æ–≤ –Ω—É–∂–Ω–∞ –±–∞–Ω–¥–∞",
        "expected": "high",  # –ü—Ä–∏–∑—ã–≤ –∫ –Ω–∞—Å–∏–ª–∏—é
        "old_score": 0.15,
    },
    {
        "text": "–ù–∞—Ä–æ–¥ —Ç—Ä—É—Å—ã –ø–æ—Ç–æ–º—É —á—Ç–æ , –∏ —ç—Ç–æ —Å—Ö–∞–≤–∞—é—Ç! –ë–µ–∑ –æ–±–∏–¥",
        "expected": "medium",  # –û—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ
        "old_score": 0.15,
    },
    {
        "text": "–ì–æ–ª–æ—Å—É–π—Ç–µ –∑–∞ –°–∞–Ω–∂–∞—Ä–∞! –ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –º–æ–ª–æ–¥—ã—Ö, –∞ —Ç–æ —Å–∏–¥—è—Ç –ø–æ 30 –ª–µ—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –∞–º–µ–±—ã, —Ç–æ–ª–∫—É –Ω–µ—Ç –æ—Ç –Ω–∏—Ö.",
        "expected": "medium",  # –û—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ "–∞–º–µ–±—ã"
        "old_score": 0.10,
    },
    {
        "text": "–£–∂–∞—Åüò±. –û–¥–Ω–∏ —Ä–µ–∫–µ—Ç–∏—Ä—ã, –±–∞–Ω–¥–∏—Ç—ã, —Å—ã–Ω–æ–≤—å—è –∫–æ–º–º—É–Ω–∏—Å—Ç–æ–≤. –ù–µ —É–º–µ—é—Ç –≤–µ—Å—Ç–∏ –¥–∏–∞–ª–æ–≥ —Å –Ω–∞—Ä–æ–¥–æ–º —Å—Ö–æ–¥—É –≤ –¥—Ä–∞–∫—É –ª–µ–∑—É—Ç –∞ –ø–æ—Ç–æ–º –µ—â–µ –≥–æ–≤–æ—Ä—è—Ç —á—Ç–æ –Ω–∞—Ä–æ–¥ —Å–±—Ä–æ–¥, –≤–∞–Ω–¥–∞–ª—ã, –≥—Ä–∞–±–∏—Ç–µ–ª–∏, —É–±–∏—Ü—ã, —Ç–µ—Ä—Ä–æ—Ä–∏—Å—Ç—ãü§¨",
        "expected": "high",  # –û–±–≤–∏–Ω–µ–Ω–∏—è –≤ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è—Ö
        "old_score": 0.26,
    },
    {
        "text": "–ù–∞–∑–∞—Ä–±–∞–π—Å–∫–∏ –∏ –¢–æ“£“õ–∞–π–≤ –∏ –µ–≥–æ –ø—Ä–æ–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –¥–µ–±–∏–ª–∏–∑–º —Ç–æ—á–Ω–∞ –¥–µ–±–∏–ª–∏üòÑüò°ü§¨",
        "expected": "medium",  # –û—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ
        "old_score": 0.14,
    },
    {
        "text": "–Ø–π—Ü–∞ –∫–∞–∫ —É –º–∏–Ω–∏—Å—Ç—Ä–∞?üòÇüòÇüòÇ–º–∞–ª—é—Å–µ–Ω—å–∫–∏–µ",
        "expected": "medium",  # –û—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ
        "old_score": 0.12,
    },
    {
        "text": "–ó–∞—á–µ–º –æ–Ω–∏ –≤—Å–µ –Ω—É–∂–Ω—ã –¥–æ—Ä–º–æ–µ–¥—ã .",
        "expected": "medium",  # –û—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ
        "old_score": 0.19,
    },
    {
        "text": "–®–∞—Ä–ª–∞–ø–∞–π–∫–∏–Ω–∞ –≤–æ–Ω –∏–∑ –ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ!",
        "expected": "medium",  # –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ —É–±—Ä–∞—Ç—å + –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ
        "old_score": 0.12,
    },
    {
        "text": "–£ –º–µ–Ω—è –µ—Å—Ç—å –æ–¥–∏–Ω –∑–Ω–∞–∫–æ–º—ã–π –ø–æ –Ω–∞—Ü–∏–π –ë–µ–ª–∞—Ä—É—Å—å, –∑–∞–≤—Ç—Ä–∞ –ø–æ–π–¥—É –ø–æ–±—å—é –µ–≥–æ, –∑–∞ —ç—Ç–∏—Ö –ø–∞—Ü–∞–Ω–æ–≤ –æ—Ç–æ—Ä–≤—É—Å—å...",
        "expected": "high",  # –£–≥—Ä–æ–∑–∞ –Ω–∞—Å–∏–ª–∏—è
        "old_score": 0.30,
    },
    {
        "text": "–§—É —Ä–æ–∂—É –Ω–∞–∑–∞—Ä–±–∞–µ–≤–∞, –∑–∞—á–µ–º –ø–æ–∫–∞–∑–∞–ª–∏, –Ø —á—É—Ç—å –Ω–µ –±–ª–µ–≤–∞–Ω—É–ª  –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ –µ–≥–æ –Ω–∏–∫–æ–≥–¥–∞ –∏ –Ω–µ–≥–¥–µ.",
        "expected": "medium",  # –ì—Ä—É–±–æ—Å—Ç—å
        "old_score": 0.30,
    },
    {
        "text": "–•—Ä–µ–Ω –≤–∞–º –ø–µ—Ä–µ–∫—É–ø—ã",
        "expected": "medium",  # –ì—Ä—É–±–æ—Å—Ç—å
        "old_score": 0.30,
    },
    {
        "text": "–ê–∫–∏–º–∞—Ç –∫–∞–∫ —Ñ–∞—à–∏—Å—Ç—ã. –ñ–∏—Ç–µ–ª–∏ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—é—Ç –∞–∫–∏–º–∞—Ç –∫–∞–∫ –≤—Ä–µ–¥–∏—Ç–µ–ª–µ–π –∏ –≤–∞–Ω–¥–∞–ª–æ–≤.",
        "expected": "high",  # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ñ–∞—à–∏—Å—Ç–∞–º–∏
        "old_score": 0.30,
    },
    # –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (–Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–æ–∫—Å–∏—á–Ω—ã–º–∏)
    {
        "text": "–°–ø–∞—Å–∏–±–æ –±–æ–ª—å—à–æ–µ –¥–æ—Ä–æ–≥–æ–π —Ç–æ–≤–∞—Ä–∏—â –∑–∞ –≤–∞—à—É —Ä–∞–±–æ—Ç—É!",
        "expected": "low",
        "old_score": 0.00,
    },
    {
        "text": "–ú–æ–ª–æ–¥–µ—Ü!!! –ú—ã –∑–∞ —á–∏—Å—Ç—ã–π –≥–æ—Ä–æ–¥!!! –ê–ª–º–∞-–ê—Ç–∞!!!",
        "expected": "low",
        "old_score": 0.00,
    },
    {
        "text": "–í—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å! - –æ—Ç–ª–∏—á–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ!",
        "expected": "low",
        "old_score": 0.00,
    },
]


def test_patterns():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã"""
    print("=" * 80)
    print("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –≠–í–†–ò–°–¢–ò–ß–ï–°–ö–ò–• –ü–ê–¢–¢–ï–†–ù–û–í")
    print("=" * 80)
    print()

    for i, case in enumerate(test_cases, 1):
        text = case["text"]
        expected = case["expected"]
        old_score = case["old_score"]

        pattern_score = detect_toxicity_patterns(text)
        language = detect_language(text)

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ —Å–∫–æ—Ä—É
        if pattern_score >= 0.7:
            category = "high"
        elif pattern_score >= 0.4:
            category = "medium"
        elif pattern_score >= 0.2:
            category = "low-medium"
        else:
            category = "low"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è–º
        match = (
            (expected == "high" and category == "high")
            or (expected == "medium" and category in ["medium", "high"])
            or (expected == "low" and category == "low")
        )

        status = "‚úì" if match else "‚úó"

        print(f"{status} –¢–µ—Å—Ç {i}: {category.upper()} (—Å–∫–æ—Ä: {pattern_score:.3f}, –±—ã–ª–æ: {old_score:.3f})")
        print(f"   –Ø–∑—ã–∫: {language}")
        print(f"   –¢–µ–∫—Å—Ç: {text[:80]}{'...' if len(text) > 80 else ''}")
        print()

    print("=" * 80)


def test_normalization():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é"""
    print("\n" + "=" * 80)
    print("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–ò")
    print("=" * 80)
    print()

    test_texts = [
        "–°–ü–ê–°–ò–ë–û –ë–û–õ–¨–®–û–ï!!!",
        "–ú–û–õ–û–î–ï–¶!!!",
        "–£–ë–ò–¢–¨ –í–°–ï–•!!!",
        "–î–µ–±–∏–ª   —Ç—É–ø–æ–π   –∏–¥–∏–æ—Ç",
        "–ù–æ—Ä–º–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ –ø—Ä–æ–±–ª–µ–º",
    ]

    for text in test_texts:
        normalized_soft = normalize_text(text, aggressive=False)
        normalized_aggressive = normalize_text(text, aggressive=True)

        is_positive = any(
            word in text.lower()
            for word in [
                "—Å–ø–∞—Å–∏–±–æ",
                "–±–ª–∞–≥–æ–¥–∞—Ä—é",
                "–º–æ–ª–æ–¥–µ—Ü",
                "–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é",
                "—Å–æ–≥–ª–∞—Å–µ–Ω",
            ]
        )

        print(f"–û—Ä–∏–≥–∏–Ω–∞–ª:     {text}")
        print(f"–ú—è–≥–∫–∞—è:       {normalized_soft}")
        print(f"–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è:  {normalized_aggressive}")
        print(f"–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π:   {is_positive}")
        print()


if __name__ == "__main__":
    test_patterns()
    test_normalization()

